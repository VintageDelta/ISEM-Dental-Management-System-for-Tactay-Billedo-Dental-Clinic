{% extends "core/base.html" %}
{% load static %}
{% block title %}Reports Dashboard{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="max-w-7xl mx-auto space-y-8">

    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <h1 class="text-2xl font-bold text-gray-800">
            Reports Dashboard
        </h1>

        <div class="flex flex-wrap items-end gap-2">
            <!-- Range Filters -->
            <a href="?range=daily&start_date={{ start_date }}&end_date={{ end_date }}" class="px-4 py-2 rounded text-sm font-medium
           {% if range_type == 'daily' %}bg-blue-600 text-white{% else %}bg-gray-200{% endif %}">
                Daily
            </a>

            <a href="?range=monthly&start_date={{ start_date }}&end_date={{ end_date }}" class="px-4 py-2 rounded text-sm font-medium
           {% if range_type == 'monthly' %}bg-blue-600 text-white{% else %}bg-gray-200{% endif %}">
                Monthly
            </a>

            <form method="GET" class="flex flex-col">
                <span class="text-[10px] font-bold text-gray-400 ml-1 mb-0.5 uppercase tracking-wider">Specific Range Filter</span>
                <div class="flex items-center gap-2">
                    <div class="flex items-center bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden focus-within:ring-2 focus-within:ring-blue-500/20 focus-within:border-blue-500">
                        <input type="date" name="start_date" value="{{ start_date }}"
                            class="text-sm border-none focus:ring-0 py-1.5 w-32 md:w-36 text-gray-600 cursor-pointer">
                        
                        <span class="text-gray-300">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M13 7l5 5m0 0l-5 5m5-5H6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        
                        <input type="date" name="end_date" value="{{ end_date }}"
                            class="text-sm border-none focus:ring-0 py-1.5 w-32 md:w-36 text-gray-600 cursor-pointer">
                    </div>
                    
                    <button type="submit" class="p-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors shadow-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </button>
                </div>
                <input type="hidden" name="range" value="{{ range_type }}">
            </form>

            <!-- Divider -->
            <div class="w-px h-6 bg-gray-300 mx-2"></div>

            <!-- Export Buttons -->
            <a href="{% url 'reports:export' %}?range={{ range_type }}&format=excel"
                class="group relative inline-flex items-center px-4 py-2 rounded bg-green-600 text-white text-sm font-medium hover:bg-green-700">
                Export Excel
                <span class="pointer-events-none absolute bottom-full mb-2
               opacity-0 scale-95
               group-hover:opacity-100 group-hover:scale-100
               transition-all duration-200
               whitespace-nowrap
               rounded bg-green-900 px-2 py-1
               text-xs text-green-100 shadow-lg">
                    Data & breakdowns
                </span>
            </a>

            <form>{% csrf_token %}</form> <button
                onclick="handlePdfExport('{% url 'reports:export' %}?range={{ range_type }}&format=pdf&start_date={{ start_date }}&end_date={{ end_date }}')"
                class="group relative inline-flex items-center px-4 py-2 rounded bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700">
                Export PDF
                <span class="pointer-events-none absolute bottom-full mb-2
               opacity-0 scale-95
               group-hover:opacity-100 group-hover:scale-100
               transition-all duration-200
               whitespace-nowrap
               rounded bg-indigo-900 px-2 py-1
               text-xs text-indigo-100 shadow-lg">
                    Charts & summary
                </span>
            </button>
        </div>
    </div>

    {% include "reports/summary_cards.html" %}

    {% include "reports/charts.html" %}

    {% include "reports/data_table.html" %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/reports_charts.js' %}"></script>
<script src="{% static 'js/reports_export.js' %}"></script>
{% endblock %}