{% extends 'core/base.html' %}
{% load static %}

{% block title %}Appointments{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="w-full">
  <!-- Page header -->
  <div class="w-full p-4 rounded-xl">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <h4 class="capitalize text-lg font-medium">Appointments</h4>
      <nav aria-label="breadcrumb" class="mt-2 md:mt-0">
        <ol class="flex space-x-2 text-sm text-gray-500">
          <li>
            <a href="{% url 'dashboard:index' %}" class="hover:text-gray-700 flex items-center gap-1">
              <i class="las la-home"></i> Dashboard
            </a>
          </li>
          <li class="text-gray-400">/</li>
          <li class="text-gray-700 font-medium">Appointments</li>
        </ol>
      </nav>
    </div>
  </div>
</div>

<!-- Main grid -->
<div class="grid grid-cols-1 lg:grid-cols-[700px_auto] gap-4 mt-6">
  <!-- Calendar section -->
  <div class="flex flex-col">
    <!-- Create appointment button (full width, outside card) -->
    <button id="create-appointment-btn"
      class="w-[700px] mb-3 px-3 py-2 text-sm bg-green-600 text-white rounded-md flex items-center justify-center gap-1 hover:bg-green-700 transition">
      <i class="la la-plus"></i> Create Appointment
    </button>

    <!-- Calendar card -->
    <div class="bg-white p-5 md:p-6 rounded-xl shadow flex flex-col w-[700px]">
      <div id="calendar" class="w-full"></div>
    </div>
  </div>

  <!-- Todayâ€™s appointments timeline -->
<div class="bg-white p-5 md:p-6 rounded-xl shadow w-full">
  <!-- External Calendar Controls go here -->
  <div id="calendar-controls" class="flex items-center gap-2 mb-4"></div>

  <div class="relative pl-4 border-l border-gray-300 max-h-[600px] overflow-y-auto">
    <ul id="todays-appointments-list" class="space-y-6">
      <!-- Example timeline items -->
      <li class="relative">
        <div class="absolute -left-2 top-1 w-3 h-3 rounded-full bg-blue-500"></div>
        <p class="text-sm text-gray-500">09:00 AM</p>
        <p class="font-medium text-gray-800">Dental Check-up - John Doe</p>
      </li>
      <li class="relative">
        <div class="absolute -left-2 top-1 w-3 h-3 rounded-full bg-green-500"></div>
        <p class="text-sm text-gray-500">11:00 AM</p>
        <p class="font-medium text-gray-800">Follow-up - Jane Smith</p>
      </li>
      <li class="relative">
        <div class="absolute -left-2 top-1 w-3 h-3 rounded-full bg-purple-500"></div>
        <p class="text-sm text-gray-500">02:00 PM</p>
        <p class="font-medium text-gray-800">Consultation - Mark Lee</p>
      </li>
    </ul>
  </div>
</div>

</div>

<!-- Add Appointment Modal -->
<div id="appointment-modal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
  <div id="appointment-modal-content"
    class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 transform transition-all duration-200 opacity-0 scale-95">
    <h2 class="text-lg font-semibold mb-4 text-center">Add Appointment</h2>
    <form method="post" class="space-y-4">
      {% csrf_token %}
      <!-- Patient Name -->
      <input type="text" name="customer_name" placeholder="Patient Name" required
        class="w-full border rounded-md p-2 text-sm">

      <!-- Service -->
      <div>
        <label for="service" class="block text-sm font-medium mb-1">Service</label>
        <input type="text" id="service" name="service" placeholder="e.g., Tooth Extraction"
          class="w-full border rounded-md p-2 text-sm" required>
      </div>

      <!-- Start -->
      <div>
        <label class="block text-sm font-medium mb-1">Date and Time</label>
        <div class="flex gap-2">
          <input type="date" name="start_date" required class="flex-1 border rounded-md p-2 text-sm">
          <input type="time" name="start_time" required class="flex-1 border rounded-md p-2 text-sm">
        </div>
      </div>

      <!-- Location -->
      <div>
        <label for="location" class="block text-sm font-medium mb-1">Location</label>
        <select id="location" name="location" required
          class="w-full border rounded-md p-2 text-sm">
          <option value="" disabled selected>Select location</option>
          <option value="Vigan">Vigan</option>
          <option value="Magsingal">Magsingal</option>
        </select>
      </div>

      <!-- Description -->
      <textarea name="description" placeholder="Description" rows="3"
        class="w-full border rounded-md p-2 text-sm"></textarea>

      <!-- Actions -->
      <div class="flex justify-end gap-2 pt-3">
        <button type="button" id="close-appointment-btn"
          class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Cancel</button>
        <button type="submit"
          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="{% static 'js/calendar.js' %}"></script>
<script src="{% static 'js/appointment.js' %}"></script>
<script src="{% static 'js/modal.js' %}"></script>
{% endblock %}
