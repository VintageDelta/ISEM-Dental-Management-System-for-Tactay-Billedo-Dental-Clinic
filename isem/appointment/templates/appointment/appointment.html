{% extends 'core/base.html' %}
{% load static %}

{% block title %}Appointments{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="w-full">
  <!-- Page header -->
  <div class="w-full p-4 rounded-xl">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <h4 class="capitalize text-lg font-medium">Appointments</h4>
      <nav aria-label="breadcrumb" class="mt-2 md:mt-0">
        <ol class="flex space-x-2 text-sm text-gray-500">
          <li>
            <a href="{% url 'dashboard:index' %}" class="hover:text-gray-700 flex items-center gap-1">
              <i class="las la-home"></i> Dashboard
            </a>
          </li>
          <li class="text-gray-400">/</li>
          <li class="text-gray-700 font-medium">Appointments</li>
        </ol>
      </nav>
    </div>
  </div>
</div>

<!-- Main grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
  <!-- Calendar section -->
  <div class="bg-white p-5 md:p-6 rounded-xl shadow flex flex-col lg:col-span-2">
    <!-- Controls -->
    <div class="flex justify-between items-center mb-4">
      <button id="create-appointment-btn"
        class="px-3 py-2 text-sm bg-green-600 text-white rounded-md flex items-center gap-1 hover:bg-green-700 transition">
        <i class="la la-plus"></i> Create Appointment
      </button>
      <div id="calendar-controls" class="flex items-center gap-2"></div>
    </div>
    <!-- Calendar -->
    <div id="calendar" class="w-full max-w-4xl mx-auto"></div>
  </div>

  <!-- Todayâ€™s appointments timeline -->
  <div class="bg-white p-5 md:p-6 rounded-xl shadow">
    <h3 class="text-lg font-semibold mb-4">Today's Appointments</h3>
    <div class="relative pl-4 border-l border-gray-300 max-h-[600px] overflow-y-auto">
      <ul id="todays-appointments-list" class="space-y-6">
        <!-- Example timeline items -->
        <li class="relative">
          <div class="absolute -left-2 top-1 w-3 h-3 rounded-full bg-blue-500"></div>
          <p class="text-sm text-gray-500">09:00 AM</p>
          <p class="font-medium text-gray-800">Dental Check-up - John Doe</p>
        </li>
        <li class="relative">
          <div class="absolute -left-2 top-1 w-3 h-3 rounded-full bg-green-500"></div>
          <p class="text-sm text-gray-500">11:00 AM</p>
          <p class="font-medium text-gray-800">Follow-up - Jane Smith</p>
        </li>
        <li class="relative">
          <div class="absolute -left-2 top-1 w-3 h-3 rounded-full bg-purple-500"></div>
          <p class="text-sm text-gray-500">02:00 PM</p>
          <p class="font-medium text-gray-800">Consultation - Mark Lee</p>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Add Appointment Modal -->
<div id="appointment-modal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 items-center justify-center">
  <div id="appointment-modal-content"
    class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 transform transition-all duration-200 opacity-0 scale-95">
    <h2 class="text-lg font-semibold mb-4 text-center">Add Appointment</h2>
    <form method="post" class="space-y-4">
      {% csrf_token %}
      <!-- Patient Name -->
      <input type="text" name="customer_name" placeholder="Patient Name" required
        class="w-full border rounded-md p-2 text-sm">

      <!-- Start -->
      <div class="flex gap-2">
        <label class="flex-none w-14 text-sm font-medium pt-2">Start</label>
        <input type="date" name="start_date" required class="flex-1 border rounded-md p-2 text-sm">
        <input type="time" name="start_time" required class="flex-1 border rounded-md p-2 text-sm">
      </div>

      <!-- End -->
      <div class="flex gap-2">
        <label class="flex-none w-14 text-sm font-medium pt-2">End</label>
        <input type="date" name="end_date" required class="flex-1 border rounded-md p-2 text-sm">
        <input type="time" name="end_time" required class="flex-1 border rounded-md p-2 text-sm">
      </div>

      <!-- Description -->
      <textarea name="description" placeholder="Description" rows="3"
        class="w-full border rounded-md p-2 text-sm"></textarea>

      <!-- Actions -->
      <div class="flex justify-end gap-2 pt-3">
        <button type="button" id="close-appointment-btn"
          class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Cancel</button>
        <button type="submit"
          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="{% static 'js/calendar.js' %}"></script>
<script src="{% static 'js/appointment.js' %}"></script>
<script src="{% static 'js/modal.js' %}"></script>
{% endblock %}