{% extends 'core/base.html' %}
{% load static %}

{% block title %}Appointments{% endblock %}

{% block content %}

<div class="max-w-6xl mx-auto space-y-4">

  <!-- Header row with title, Logs button, and New appointment button -->
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold text-gray-800">Appointments</h1>

    <div class="flex items-center gap-2">
      {% if request.user.is_staff or request.user.is_superuser %}
        <!-- Logs button only for staff/admin -->
        <a href="{% url 'appointment:logs' %}"
          class="inline-flex items-center px-4 py-2 rounded-md bg-gray-200 text-gray-800 text-sm font-medium hover:bg-gray-300">
          <span class="material-icons text-base mr-1">history</span>
          Logs
        </a>
      {% endif %}
    </div>
  </div>

<!-- Main layout: calendar + timeline -->
<div class="flex flex-col md:flex-row gap-4 mt-6 items-stretch">
  <!-- Calendar section -->
  <div class="flex flex-col w-full md:flex-1 md:max-w-[700px]">
    <!-- Create appointment button (full width, outside card) -->
    <button id="create-appointment-btn"
      title="Create a new appointment for a patient."
      class="w-full mb-3 px-3 py-2 text-sm bg-green-600 text-white rounded-md flex items-center justify-center gap-1 hover:bg-green-700 transition">
      <i class="la la-plus"></i> Create Appointment
    </button>
    <!-- Calendar card -->
    <div class="bg-white p-3 md:p-5 lg:p-6 rounded-xl shadow flex flex-col w-full">
      <!-- Drop down Branch Select-->
      <div class="mb-4">
        <label class="font-semibold block mb-1 text-sm">Select Branch:</label>

        <div class="w-full max-w-full">
          <select
            id="branch-filter"
            class="block w-full border p-2 rounded-md text-sm truncate"
          >
            <option value="">All Branches</option>
            {% for branch in branches %}
              <option value="{{ branch.name }}">
                {{ branch.name }},
                {% if branch.address %}
                  {{ branch.address }}
                {% else %}
                  .......
                {% endif %}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="w-full overflow-x-auto">
        <div class="w-full md:min-w-[360px] text-xs md:text-sm px-1 md:px-0">
          <div id="calendar" class="h-full"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Timeline + list section -->
  <div class="w-full md:flex-1">
    <div class="bg-white p-3 md:p-4 lg:p-6 rounded-xl shadow w-full">

      <!-- Timeline legend (now on top) -->
      <div class="flex flex-wrap items-center justify-center gap-2 mb-3 text-[11px] text-slate-600">
        <span class="flex items-center gap-1">
          <span class="h-2 w-2 rounded-full" style="background-color:#9CA3AF;"></span>
          Not yet arrived
        </span>
        <span class="flex items-center gap-1">
          <span class="h-2 w-2 rounded-full" style="background-color:#3B82F6;"></span>
          Arrived
        </span>
        <span class="flex items-center gap-1">
          <span class="h-2 w-2 rounded-full" style="background-color:#F59E0B;"></span>
          On going
        </span>
        <span class="flex items-center gap-1">
          <span class="h-2 w-2 rounded-full" style="background-color:#10B981;"></span>
          Done
        </span>
        <span class="flex items-center gap-1">
          <span class="h-2 w-2 rounded-full" style="background-color:#EF4444;"></span>
          Cancelled
        </span>
      </div>

      <!-- Timeline wrapper -->
      <div class="w-full overflow-x-auto mb-4">
        <!-- Scrollable wrapper; height synced from JS -->
        <div id="timeline-scroll" class="w-full overflow-y-auto h-full">
          <div class="w-full md:min-w-[360px] text-xs md:text-sm px-1 md:px-0 h-full">
            <div id="timeline-calendar" class="h-full"></div> <!-- h-full -->
          </div>
        </div>
      </div>

      <!-- Timeline list (hidden for now) -->
      <div class="hidden relative pl-3 md:pl-4 border-l border-gray-300 max-h-[400px] md:max-h-[600px] overflow-y-auto">
        <ul id="todays-appointments-list" class="space-y-6"></ul>
      </div>
    </div>
  </div>




{# Put the includes here, after the main layout #}
{% include "appointment/appointment_modal.html" %}
{% include "appointment/done_steps_modal.html" %}
{% include "appointment/reschedule_modal.html" %}
{% include "appointment/pop_up_modals.html" %}
{% include "appointment/followup_modal.html" %}
{% include "appointment/notify_modal.html" %}
{% include "appointment/status_modal.html" %}

{% endblock %}


{% block extra_js %}

<script>
  // dont remove this, this should be in the Calendar.js but no, it dont work if its in therre!
  const eventsUrl = "{% url 'appointment:events' %}";
</script>

<script src="{% static 'vendor/fullcalendar/index.global.min.js' %}"></script>
{% comment %} <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script> {% endcomment %}
<script src="{% static 'js/calendar.js' %}"></script>
<script src="{% static 'js/calendar_mobile.js' %}"></script>
<script src="{% static 'js/appointment_mobile.js' %}"></script>
<script src="{% static 'js/appointment.js' %}"></script>


{% endblock %}
